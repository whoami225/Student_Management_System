package dao;

import model.Attendance;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import util.DBUtil;

public class AttendanceDAO {
    private Connection conn;
    
    public AttendanceDAO() {
        conn = DBUtil.getConnection();
    }
    
    public boolean markAttendance(Attendance attendance) {
        try {
            String query = "INSERT INTO attendance (student_id, subject_id, date, status) VALUES (?, ?, ?, ?)";
            PreparedStatement ps = conn.prepareStatement(query);
            ps.setInt(1, attendance.getStudentId());
            ps.setInt(2, attendance.getSubjectId());
            ps.setDate(3, new java.sql.Date(attendance.getDate().getTime()));
            ps.setString(4, attendance.getStatus());
            
            int result = ps.executeUpdate();
            return result > 0;
        } catch (SQLException e) {
            e.printStackTrace();
            return false;
        }
    }
    
    public List<Attendance> getAttendanceByStudent(int studentId) {
        List<Attendance> attendances = new ArrayList<>();
        try {
            String query = "SELECT * FROM attendance WHERE student_id = ? ORDER BY date DESC";
            PreparedStatement ps = conn.prepareStatement(query);
            ps.setInt(1, studentId);
            
            ResultSet rs = ps.executeQuery();
            while (rs.next()) {
                Attendance attendance = new Attendance();
                attendance.setAttendanceId(rs.getInt("attendance_id"));
                attendance.setStudentId(rs.getInt("student_id"));
                attendance.setSubjectId(rs.getInt("subject_id"));
                attendance.setDate(rs.getDate("date"));
                attendance.setStatus(rs.getString("status"));
                attendances.add(attendance);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return attendances;
    }
    
    // Optional methods
    public List<Attendance> getAttendanceByDate(Date date) { /* implementation */ }
    public List<Attendance> getAttendanceBySubject(int subjectId) { /* implementation */ }
}